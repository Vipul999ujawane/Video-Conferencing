<!DOCTYPE html>
<html>
<head>
    <title>test</title>
    <script src="peer.js"></script>
    <script src="jquery-3.2.1.min.js"></script>
    <script src="//www.WebRTC-Experiment.com/RecordRTC.js"></script>
</head>
<body>
  <p>ID: </p><p id="uid"></p>
  Last Name: <input type="text" id="myText2" >
  <button onclick="myFunction2()">Call</button>

    <video id="mevideo" autoplay></video>
    <video id='oppvideo' autoplay></video>
<script>
function randid(){
  function s4(){
    return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);
  }
  id= s4()+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+s4()+s4();
  $('#uid').text(id);
  return id;
}
var from1=randid();
var to1;

/*
function getVideo(successCallback, errorCallback){
    navigator.getUserMedia({
        audio: true,
        video: true
    }, successCallback, errorCallback);
}
function onReceiveCall(call){

    console.log('peer is calling...');
    console.log(call);

    getVideo(
        function(MediaStream){
            call.answer(MediaStream);
            console.log('answering call started...');
        },
        function(err){
            console.log('an error occured while getting the Video');
            console.log(err);
        }
    );

    call.on('stream', onReceiveStream);
}
function onReceiveStream(stream){
    var video = document.querySelector('video');
    video.src = window.URL.createObjectURL(stream);
}*/
var from = from1;
var to = to1;
var peer = new Peer({
    key: 'peerjs',
    path: '/peerjs', // <==========
    host: 'localhost',
    port: 9000
});


/*
$('#start-call').click(function(){

    console.log('starting call...');

    getVideo(
        function(MediaStream){

            console.log('now calling ' + to);
            var call = peer.call(to, MediaStream);
            call.on('stream', onReceiveStream);
        },
        function(err){
            console.log('an error occured while getting the Video');
            console.log(err);
        }
    );

});*/
peer.on('error', function (err) {
       console.log(err);
       alert(err);
   });

   function handleCall(call) {
        call.on('stream', function (remoteStream) {
            console.log('set thier');
            //$('#call').hide();
            //$('#oppvideo').show();
            $('#oppvideo').prop('src', URL.createObjectURL(remoteStream));
            console.log('yolo');
        });
    }


peer.on('open', function(id){
  console.log('My peer ID is: ' + id);
    $('#uid').text(id);
          ;});



var constraints = window.constraints = {audio: true,  video: true};
navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
                window.localStream = stream;
                $('#mevideo').prop('src', URL.createObjectURL(stream));
                peer.on('call', function (call) {
                    call.answer(stream); // Answer the call with an A/V stream.
                    handleCall(call);
                });});

                function myFunction2() {
                var x = document.getElementById("myText2").value;
                to=x;

                var call=peer.call(to,window.localStream);
                handleCall(call);
                }

</script>
    <script src="jquery-3.2.1.min.js"></script>
  </body>
  </html>
